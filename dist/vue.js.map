{"version":3,"file":"vue.js","sources":["../src/observer/array.js","../src/observer/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["let oldArrayProtoMethods = Array.prototype\r\n\r\n// 不能直接改写数组原有方法 不可靠 只有被vue控制的数组才需要改写\r\n\r\nexport let arrayMethods = Object.create(Array.prototype)\r\n\r\nlet methods = [\r\n  'push',\r\n  'pop',\r\n  'shift',\r\n  'unshift',\r\n  'splice',\r\n  'reverse',\r\n  'sort'\r\n]\r\n\r\nmethods.forEach(method => { // AOP切片编程\r\n  arrayMethods[method] = function (...args) { // 重写数组方法\r\n    // todo ...\r\n   console.log('数组变化了')\r\n   let result = oldArrayProtoMethods[method].call(this, ...args)\r\n   return result\r\n  }\r\n})","import { arrayMethods } from \"./array\"\r\n\r\nclass Observer {\r\n  constructor(value) { // 需要对这个value属性重新定义\r\n\r\n    // value可能是对象， 可能是数组， 分类处理\r\n\r\n    if(Array.isArray(value)) {\r\n      // 数组不用defineProperty来进行代理 性能不好\r\n\r\n      // push shift reverse sort 我要重写这些方法增加更新逻辑\r\n     // value.__proto__ = arrayMethods\r\n      Object.setPrototypeOf(value, arrayMethods) // Object.setPrototypeOf方法设置一个指定的对象的原型\r\n      this.observeArray(value) // 原有数组的对象 Object.freeze()\r\n    }else {\r\n      this.walk(value)\r\n    }\r\n  }\r\n\r\n  observeArray(value) {\r\n    for(let i = 0;i < value.length;i++) {\r\n      observe(value[i]) // 监测数组中的对象\r\n    }\r\n  }\r\n  \r\n  walk(data) {\r\n    // 将对象中的所有key 重新用defineProperty定义成响应式的\r\n    Object.keys(data).forEach(key => {\r\n      defineReactive(data, key, data[key])\r\n    })\r\n  }\r\n}\r\n\r\n// 把对象设置为响应式\r\nexport function defineReactive(data, key, value) { // vue2中数据嵌套不要过深， 过深浪费性能\r\n\r\n  // value 可能也是一个对象\r\n  observe(value)\r\n\r\n  Object.defineProperty(data, key, { \r\n    get() {\r\n      return value\r\n    },\r\n    set(newVal) {\r\n      if(newVal === value) return\r\n      observe(newVal) // 如果用户设置的是一个对象，就继续将用户设置的对象变成响应式的\r\n      value = newVal\r\n    }\r\n  })\r\n}\r\n\r\nexport function observe(data) {\r\n  // 只对对象类型进行观测 非对象类型无法观测\r\n  if(typeof data !== 'object' || data === null) {\r\n    return\r\n  }\r\n  // 通过类来对实现对数据的观测， 类可以方便扩展， 会产生实例\r\n  return new Observer(data)\r\n}","import { observe } from \"./observer/index\"\r\n\r\n// vue的数据 data computed watch....\r\nexport function initState(vm) {\r\n  // 将所有数据都定义在 vm属性上， 并且后续修改， 需要触发视图更新\r\n  const opts = vm.$options // 获取用户属性\r\n\r\n  if(opts.data) { // 数据的初始化\r\n    initData(vm)\r\n  }\r\n}\r\n// 数据代理，当用户直接访问vm的属性时，读取_data的值，修改同理\r\nfunction proxy(vm, source, key) {\r\n  Object.defineProperty(vm, key, {\r\n    get() {\r\n      return vm[source][key]\r\n    },\r\n    set(newVal) {\r\n     vm[source][key] = newVal \r\n    }\r\n  })\r\n}\r\n\r\nfunction initData(vm) {\r\n  // 数据劫持 Object.defineProperty\r\n  let data = vm.$options.data\r\n  // 对data类型进行判断 如果是函数 获取函数返回值作为对象\r\n  data = vm._data = typeof data === 'function' ? data.call(vm) : data\r\n  // 通过vm._data 获取劫持后的数据， 用户就可以拿到_data\r\n  // 将_data中的数据全部放到vm上\r\n  for(let key in data) {\r\n    proxy(vm, '_data', key) // vm.name => vm._data.name\r\n  }\r\n  // 观测这个数据\r\n  observe(data)\r\n}\r\n","import { initState } from \"./state\"\r\n\r\nexport function initMixin(Vue) {\r\n  Vue.prototype._init = function(options) {\r\n    let vm = this\r\n    vm.$options = options // 实例上有一个属性$options 表示用户传入的属性\r\n    // 初始化状态\r\n    initState(vm)\r\n  }\r\n}\r\n\r\n\r\n","// vue2.0中就是一个构造函数\r\n\r\nimport { initMixin } from \"./init\"\r\n\r\nfunction Vue(options) {\r\n  this._init(options) // 当用户new Vue时调用init方法进行vue的初始化操作\r\n}\r\n\r\n// 可以拆分逻辑到不同的文件中，更利于代码维护，模块化概念\r\n\r\ninitMixin(Vue)\r\n\r\n\r\nexport default Vue"],"names":["oldArrayProtoMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","console","log","args","result","call","Observer","value","isArray","setPrototypeOf","observeArray","walk","i","length","observe","data","keys","key","defineReactive","defineProperty","get","set","newVal","initState","vm","opts","$options","initData","proxy","source","_data","initMixin","Vue","_init","options"],"mappings":"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"}